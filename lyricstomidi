#!/usr/bin/env raku

grammar Lyrics {
    token TOP {
        <word>*
    }
    token word {
        | <quotedstring>
        | (\S+)
        | (\s+)
    }
    token quotedstring {
        '"' <qspart>+ '"'
    }
    token qspart {
        | <-[ " \\ ]>+
        | '\\' .
    }
}

for lines() -> $line {
    my $/ = Lyrics.parse($line);
    for $/<word> -> $word is copy {
        given $word {
            when .ends-with('-') {
                s/\-$//;
                .print;
            }
            when .starts-with('"') {
                print $_;
            }
            when '__' {
            }
            when '_' {
                print '""';
            }
            when /^\s+$/ {
                print $_;
            }
            default {
                print "\"$_ \"";
            }
        }
    }
    say '';
}

